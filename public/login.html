<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | EverCart</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .auth-container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.07);
      padding: 2.5rem 2rem;
      width: 420px;
      max-width: 95vw;
      position: relative;
      overflow: hidden;
    }
    .auth-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    .logo-section {
      text-align: center;
      margin-bottom: 2rem;
    }
    .logo-section h1 {
      color: #333;
      font-size: 2rem;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .logo-section p {
      color: #666;
      margin: 0.5rem 0 0 0;
      font-size: 0.95rem;
    }
    .auth-tabs {
      display: flex;
      margin-bottom: 2rem;
      background: #f8f9ff;
      border-radius: 12px;
      padding: 4px;
    }
    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 0.75rem 0;
      cursor: pointer;
      font-weight: 600;
      border-radius: 8px;
      transition: all 0.3s ease;
      color: #666;
      background: none;
      border: none;
      font-size: 1rem;
    }
    .auth-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    .auth-form {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    .auth-form.active {
      display: block;
    }
    .input-group {
      position: relative;
      margin-bottom: 1.5rem;
    }
    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #333;
      font-weight: 500;
      font-size: 0.95rem;
    }
    .input-group input {
      width: 100%;
      padding: 0.9rem 1rem;
      border-radius: 10px;
      border: 2px solid #e1e8ed;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #f8f9ff;
    }
    .input-group input:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: #fff;
    }
    .input-group input.error {
      border-color: #e74c3c;
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
    }
    .input-group input.success {
      border-color: #27ae60;
      box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
    }
    .input-error {
      color: #e74c3c;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      display: none;
    }
    .input-error.show {
      display: block;
    }
    .password-strength {
      margin-top: 0.5rem;
    }
    .strength-bar {
      height: 4px;
      border-radius: 2px;
      background: #e1e8ed;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    .strength-fill {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }
    .strength-text {
      font-size: 0.85rem;
      color: #666;
    }
    .password-requirements {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.5rem;
    }
    .requirement {
      display: flex;
      align-items: center;
      margin-bottom: 0.25rem;
    }
    .requirement.met {
      color: #27ae60;
    }
    .requirement::before {
      content: '✗';
      margin-right: 0.5rem;
      color: #e74c3c;
    }
    .requirement.met::before {
      content: '✓';
      color: #27ae60;
    }
    .auth-form button {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 1rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 1rem;
      position: relative;
      overflow: hidden;
    }
    .auth-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    .auth-form button:active {
      transform: translateY(0);
    }
    .auth-form button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .message {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      text-align: center;
      display: none;
    }
    .message.show {
      display: block;
    }
    .message.error {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    .message.success {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }
    .back-link {
      text-align: center;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #e1e8ed;
    }
    .back-link a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .back-link a:hover {
      color: #764ba2;
    }
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(20px);
      }
      to { 
        opacity: 1; 
        transform: translateY(0);
      }
    }
    @media (max-width: 480px) {
      .auth-container {
        padding: 2rem 1.5rem;
        margin: 20px;
      }
      .logo-section h1 {
        font-size: 1.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="logo-section">
      <h1>EverCart</h1>
      <p>Welcome back! Please sign in to your account</p>
    </div>
    
    <div class="auth-tabs">
      <button class="auth-tab active" id="login-tab">Login</button>
      <button class="auth-tab" id="signup-tab">Sign Up</button>
    </div>

    <!-- Login Form -->
    <form id="loginForm" class="auth-form active" autocomplete="on" novalidate>
      <div class="message" id="login-message"></div>
      
      <div class="input-group">
        <label for="login-email">Email Address</label>
        <input type="email" id="login-email" name="email" required autocomplete="email" />
        <div class="input-error" id="login-email-error"></div>
      </div>
      
      <div class="input-group">
        <label for="login-password">Password</label>
        <input type="password" id="login-password" name="password" required autocomplete="current-password" />
        <div class="input-error" id="login-password-error"></div>
      </div>
      
      <button type="submit" id="login-btn">
        <span class="loading-spinner"></span>
        <span class="btn-text">Sign In</span>
      </button>
    </form>

    <!-- Signup Form -->
    <form id="signupForm" class="auth-form" autocomplete="on" novalidate>
      <div class="message" id="signup-message"></div>
      
      <div class="input-group">
        <label for="signup-name">Full Name</label>
        <input type="text" id="signup-name" name="name" required autocomplete="name" />
        <div class="input-error" id="signup-name-error"></div>
      </div>
      
      <div class="input-group">
        <label for="signup-email">Email Address</label>
        <input type="email" id="signup-email" name="email" required autocomplete="email" />
        <div class="input-error" id="signup-email-error"></div>
      </div>
      
      <div class="input-group">
        <label for="signup-password">Password</label>
        <input type="password" id="signup-password" name="password" required autocomplete="new-password" />
        <div class="input-error" id="signup-password-error"></div>
        
        <div class="password-strength" id="password-strength" style="display: none;">
          <div class="strength-bar">
            <div class="strength-fill" id="strength-fill"></div>
          </div>
          <div class="strength-text" id="strength-text"></div>
        </div>
        
        <div class="password-requirements" id="password-requirements" style="display: none;">
          <div class="requirement" id="req-length">At least 8 characters</div>
          <div class="requirement" id="req-upper">One uppercase letter</div>
          <div class="requirement" id="req-lower">One lowercase letter</div>
          <div class="requirement" id="req-number">One number</div>
          <div class="requirement" id="req-special">One special character</div>
        </div>
      </div>
      
      <div class="input-group">
        <label for="signup-confirm-password">Confirm Password</label>
        <input type="password" id="signup-confirm-password" name="confirm-password" required autocomplete="new-password" />
        <div class="input-error" id="signup-confirm-password-error"></div>
      </div>
      
      <button type="submit" id="signup-btn">
        <span class="loading-spinner"></span>
        <span class="btn-text">Create Account</span>
      </button>
    </form>
    
    <div class="back-link">
      <a href="home.html">← Back to Home</a>
    </div>
  </div>
  <script>
    // Utility functions
    function showMessage(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.className = `message ${type} show`;
      setTimeout(() => {
        element.classList.remove('show');
      }, 5000);
    }

    function showInputError(inputId, message) {
      const input = document.getElementById(inputId);
      const error = document.getElementById(inputId + '-error');
      input.classList.add('error');
      input.classList.remove('success');
      error.textContent = message;
      error.classList.add('show');
    }

    function showInputSuccess(inputId) {
      const input = document.getElementById(inputId);
      const error = document.getElementById(inputId + '-error');
      input.classList.add('success');
      input.classList.remove('error');
      error.classList.remove('show');
    }

    function clearInputState(inputId) {
      const input = document.getElementById(inputId);
      const error = document.getElementById(inputId + '-error');
      input.classList.remove('error', 'success');
      error.classList.remove('show');
    }

    // Email validation
    function isValidEmail(email) {
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      return emailRegex.test(email);
    }

    // Password validation
    function validatePassword(password) {
      const requirements = {
        length: password.length >= 8,
        upper: /[A-Z]/.test(password),
        lower: /[a-z]/.test(password),
        number: /[0-9]/.test(password),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
      };
      
      const score = Object.values(requirements).filter(Boolean).length;
      let strength = 'Very Weak';
      let color = '#e74c3c';
      
      if (score >= 5) {
        strength = 'Very Strong';
        color = '#27ae60';
      } else if (score >= 4) {
        strength = 'Strong';
        color = '#2ecc71';
      } else if (score >= 3) {
        strength = 'Medium';
        color = '#f39c12';
      } else if (score >= 2) {
        strength = 'Weak';
        color = '#e67e22';
      }
      
      return { requirements, score, strength, color };
    }

    // Name validation
    function isValidName(name) {
      return name.trim().length >= 2 && /^[a-zA-Z\s'-]+$/.test(name.trim());
    }

    // Tab switching
    const loginTab = document.getElementById('login-tab');
    const signupTab = document.getElementById('signup-tab');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const logoSection = document.querySelector('.logo-section p');

    loginTab.onclick = () => {
      loginTab.classList.add('active');
      signupTab.classList.remove('active');
      loginForm.classList.add('active');
      signupForm.classList.remove('active');
      logoSection.textContent = 'Welcome back! Please sign in to your account';
      // Clear all form states
      document.querySelectorAll('.message').forEach(msg => msg.classList.remove('show'));
      document.querySelectorAll('.input-error').forEach(err => err.classList.remove('show'));
      document.querySelectorAll('input').forEach(input => input.classList.remove('error', 'success'));
    };

    signupTab.onclick = () => {
      signupTab.classList.add('active');
      loginTab.classList.remove('active');
      signupForm.classList.add('active');
      loginForm.classList.remove('active');
      logoSection.textContent = 'Create your account to get started';
      // Clear all form states
      document.querySelectorAll('.message').forEach(msg => msg.classList.remove('show'));
      document.querySelectorAll('.input-error').forEach(err => err.classList.remove('show'));
      document.querySelectorAll('input').forEach(input => input.classList.remove('error', 'success'));
    };

    // Real-time validation for login form
    document.getElementById('login-email').addEventListener('blur', function() {
      const email = this.value.trim();
      if (!email) {
        showInputError('login-email', 'Email is required');
      } else if (!isValidEmail(email)) {
        showInputError('login-email', 'Please enter a valid email address');
      } else {
        showInputSuccess('login-email');
      }
    });

    document.getElementById('login-password').addEventListener('blur', function() {
      const password = this.value;
      if (!password) {
        showInputError('login-password', 'Password is required');
      } else if (password.length < 6) {
        showInputError('login-password', 'Password is too short');
      } else {
        showInputSuccess('login-password');
      }
    });

    // Real-time validation for signup form
    document.getElementById('signup-name').addEventListener('blur', function() {
      const name = this.value.trim();
      if (!name) {
        showInputError('signup-name', 'Full name is required');
      } else if (!isValidName(name)) {
        showInputError('signup-name', 'Please enter a valid name (letters, spaces, hyphens, and apostrophes only)');
      } else {
        showInputSuccess('signup-name');
      }
    });

    document.getElementById('signup-email').addEventListener('blur', function() {
      const email = this.value.trim();
      if (!email) {
        showInputError('signup-email', 'Email is required');
      } else if (!isValidEmail(email)) {
        showInputError('signup-email', 'Please enter a valid email address');
      } else {
        showInputSuccess('signup-email');
      }
    });

    // Password strength indicator
    document.getElementById('signup-password').addEventListener('input', function() {
      const password = this.value;
      const strengthContainer = document.getElementById('password-strength');
      const requirementsContainer = document.getElementById('password-requirements');
      const strengthFill = document.getElementById('strength-fill');
      const strengthText = document.getElementById('strength-text');
      
      if (password.length === 0) {
        strengthContainer.style.display = 'none';
        requirementsContainer.style.display = 'none';
        return;
      }
      
      strengthContainer.style.display = 'block';
      requirementsContainer.style.display = 'block';
      
      const validation = validatePassword(password);
      const percentage = (validation.score / 5) * 100;
      
      strengthFill.style.width = percentage + '%';
      strengthFill.style.backgroundColor = validation.color;
      strengthText.textContent = `Password strength: ${validation.strength}`;
      strengthText.style.color = validation.color;
      
      // Update requirements
      Object.keys(validation.requirements).forEach(req => {
        const element = document.getElementById(`req-${req}`);
        if (validation.requirements[req]) {
          element.classList.add('met');
        } else {
          element.classList.remove('met');
        }
      });
    });

    document.getElementById('signup-password').addEventListener('blur', function() {
      const password = this.value;
      if (!password) {
        showInputError('signup-password', 'Password is required');
      } else {
        const validation = validatePassword(password);
        if (validation.score < 3) {
          showInputError('signup-password', 'Password is too weak. Please meet more requirements.');
        } else {
          showInputSuccess('signup-password');
        }
      }
    });

    document.getElementById('signup-confirm-password').addEventListener('blur', function() {
      const password = document.getElementById('signup-password').value;
      const confirmPassword = this.value;
      
      if (!confirmPassword) {
        showInputError('signup-confirm-password', 'Please confirm your password');
      } else if (password !== confirmPassword) {
        showInputError('signup-confirm-password', 'Passwords do not match');
      } else {
        showInputSuccess('signup-confirm-password');
      }
    });

    // Clear input states on focus
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('focus', function() {
        clearInputState(this.id);
      });
    });

    // Login form submission
    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      const loginBtn = document.getElementById('login-btn');
      const spinner = loginBtn.querySelector('.loading-spinner');
      const btnText = loginBtn.querySelector('.btn-text');
      
      // Validate inputs
      let isValid = true;
      
      if (!email) {
        showInputError('login-email', 'Email is required');
        isValid = false;
      } else if (!isValidEmail(email)) {
        showInputError('login-email', 'Please enter a valid email address');
        isValid = false;
      }
      
      if (!password) {
        showInputError('login-password', 'Password is required');
        isValid = false;
      } else if (password.length < 6) {
        showInputError('login-password', 'Password is too short');
        isValid = false;
      }
      
      if (!isValid) return;
      
      // Show loading state
      loginBtn.disabled = true;
      spinner.style.display = 'inline-block';
      btnText.textContent = 'Signing In...';
      
      try {
        const res = await fetch('http://localhost:3000/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await res.json();
        
        if (res.ok) {
          localStorage.setItem('user', JSON.stringify(data.user));
          showMessage('login-message', 'Login successful! Redirecting...', 'success');
          setTimeout(() => {
            window.location.href = 'home.html';
          }, 1000);
        } else {
          showMessage('login-message', data.message || 'Login failed. Please check your credentials.', 'error');
        }
      } catch (err) {
        showMessage('login-message', 'Server error. Please try again later.', 'error');
      } finally {
        // Reset button state
        loginBtn.disabled = false;
        spinner.style.display = 'none';
        btnText.textContent = 'Sign In';
      }
    };

    // Signup form submission
    signupForm.onsubmit = async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('signup-name').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      const confirmPassword = document.getElementById('signup-confirm-password').value;
      const signupBtn = document.getElementById('signup-btn');
      const spinner = signupBtn.querySelector('.loading-spinner');
      const btnText = signupBtn.querySelector('.btn-text');
      
      // Validate inputs
      let isValid = true;
      
      if (!name) {
        showInputError('signup-name', 'Full name is required');
        isValid = false;
      } else if (!isValidName(name)) {
        showInputError('signup-name', 'Please enter a valid name');
        isValid = false;
      }
      
      if (!email) {
        showInputError('signup-email', 'Email is required');
        isValid = false;
      } else if (!isValidEmail(email)) {
        showInputError('signup-email', 'Please enter a valid email address');
        isValid = false;
      }
      
      if (!password) {
        showInputError('signup-password', 'Password is required');
        isValid = false;
      } else {
        const validation = validatePassword(password);
        if (validation.score < 3) {
          showInputError('signup-password', 'Password is too weak. Please meet more requirements.');
          isValid = false;
        }
      }
      
      if (!confirmPassword) {
        showInputError('signup-confirm-password', 'Please confirm your password');
        isValid = false;
      } else if (password !== confirmPassword) {
        showInputError('signup-confirm-password', 'Passwords do not match');
        isValid = false;
      }
      
      if (!isValid) return;
      
      // Show loading state
      signupBtn.disabled = true;
      spinner.style.display = 'inline-block';
      btnText.textContent = 'Creating Account...';
      
      try {
        const res = await fetch('http://localhost:3000/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });
        
        const data = await res.json();
        
        if (res.ok) {
          showMessage('signup-message', 'Account created successfully! You can now log in.', 'success');
          signupForm.reset();
          document.getElementById('password-strength').style.display = 'none';
          document.getElementById('password-requirements').style.display = 'none';
          // Clear all input states
          document.querySelectorAll('input').forEach(input => input.classList.remove('error', 'success'));
          // Switch to login tab after 2 seconds
          setTimeout(() => {
            loginTab.click();
          }, 2000);
        } else {
          showMessage('signup-message', data.message || 'Registration failed. Please try again.', 'error');
        }
      } catch (err) {
        showMessage('signup-message', 'Server error. Please try again later.', 'error');
      } finally {
        // Reset button state
        signupBtn.disabled = false;
        spinner.style.display = 'none';
        btnText.textContent = 'Create Account';
      }
    };
  </script>
</body>
</html>